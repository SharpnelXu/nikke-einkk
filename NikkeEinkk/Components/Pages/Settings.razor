@page "/settings"
@rendermode RenderMode.InteractiveServer
@using System.Globalization
@using Microsoft.Extensions.Localization
@inject NavigationManager Navigation
@inject IStringLocalizer<Settings> L

<PageTitle>@L["PageTitle"]</PageTitle>

<h1>@L["Title"]</h1>

<div class="settings-section">
    <h3>@L["LanguageSection"]</h3>
    <div class="setting-item">
        <label for="locale-select">@L["SelectLanguage"]</label>
        <select id="locale-select" class="locale-select" value="@CurrentCulture" @onchange="OnLocaleChanged">
            <option value="en">English</option>
            <option value="zh">中文</option>
        </select>
    </div>
</div>

<style>
    .settings-section {
        background-color: var(--header-color);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        max-width: 500px;
    }
    .settings-section h3 {
        margin-top: 0;
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.5rem;
    }
    .setting-item {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    .setting-item label {
        font-size: 14px;
    }
    .locale-select {
        width: 100%;
        max-width: 200px;
        padding: 8px 12px;
        border: none;
        background-color: var(--button-color);
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }
    .locale-select:hover {
        background-color: var(--button-hover-color);
    }
    .locale-select option {
        background-color: var(--button-color);
    }
</style>

@code {
    private string CurrentCulture => CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;

    private void OnLocaleChanged(ChangeEventArgs e)
    {
        var newCulture = e.Value?.ToString() ?? "en";
        if (newCulture == CurrentCulture) return;

        var redirectUri = Uri.EscapeDataString("/settings");
        Navigation.NavigateTo($"/api/set-culture?culture={newCulture}&redirectUri={redirectUri}", forceLoad: true);
    }
}

